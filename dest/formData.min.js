/**
 * formData - Form validation based on data attributes
 * @date - Tue Jan 06 2015 12:46:59 GMT+0100 (Central Europe Standard Time)
 * @version - 1.0.1
 */
!function(i){"use strict";function e(e,s){this.$form=i(e),this.options=i.extend(!0,{},t,s),this.$fields=this.$form.find("[data-"+this.options.validDataAttr+"]"),this.isFormValid=!1,this.formLog={},this.version=o,this.getFieldsRules(),this.addFormEvents(),this.addFieldEvents()}var t,s,l,o,r,a;l="FormData",o="1.0.1",s={validFormClass:"formdata"},t={keyup:!1,blur:!0,validDataAttr:"valid",classSuccess:"success",classError:"error",tpl:{error:'<span class="form-error">{message}</span>'},preventSubmit:!1,onError:null,onSuccess:null},r={email:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,"float":/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/,number:/^\d+$/},a={empty:"This is a required field.",email:"Please enter a valid email address. For example name@site.com",min:"You should fill minimum {min} characters",max:"You should fill maximum {max} characters",range:"You should fill from {min} to {max} characters"},e.setup=function(e){t=i.extend(!0,{},t,e)},e.prototype.getFieldsRules=function(){var e,t,s,l,o,r=null;e=this,this.fieldsRules=[],t=0,this.$fields.each(function(){s=i(this),l=s.data(e.options.validDataAttr)||null,s.data("field-id",t),/\|/.test(l)?(l=l.split("|"),o=l[0],r=l[1],/\-/.test(r)&&(r=r.split("-"))):o=l,e.fieldsRules.push({name:o,opt:r}),t++})},e.prototype.addFieldEvents=function(){var i=this;this.$fields.on({keyup:function(e){9!==e.keyCode&&i.options.keyup&&i.validateField(this)},blur:function(){return i.options.blur?i.validateField(this):!1}})},e.prototype.addFormEvents=function(){var i=this;this.$form.on("submit",function(e){i.submitForm(),i.isFormValid?"function"==typeof i.options.onSuccess&&(e.preventDefault(),i.options.onSuccess(i.$form)):(e.preventDefault(),"function"==typeof i.options.onError&&i.options.onError(i.formLog))})},e.prototype.submitForm=function(){var i=this;this.$fields.each(function(){i.validateField(this)}),this.isFormValid=!this.parseFormLog()},e.prototype.parseFormLog=function(){var i,e;e=0;for(i in this.formLog)this.formLog[i]&&(e+=1);return e},e.prototype.validateField=function(e){switch(this.$field=i(e),this.fieldId=this.$field.data("field-id"),this.fieldName=this.$field.attr("name"),this.fieldValue=i.trim(this.$field.val()),this.fieldRuleOpt=this.fieldsRules[this.fieldId].opt,this.fieldRuleName=this.fieldsRules[this.fieldId].name?this.fieldsRules[this.fieldId].name:"empty",this.fieldRuleName){case"email":this.isFieldValid(r.email.test(this.fieldValue));break;case"min":this.isFieldValid(this.fieldValue.length>=Math.floor(this.fieldRuleOpt));break;case"max":this.isFieldValid(this.fieldValue.length<=Math.floor(this.fieldRuleOpt)&&this.fieldValue.length);break;case"range":this.isFieldValid(this.fieldValue.length>=Math.floor(this.fieldRuleOpt[0])&&this.fieldValue.length<=Math.floor(this.fieldRuleOpt[1]));break;default:this.isFieldValid(this.fieldValue.length)}},e.prototype.isFieldValid=function(i){return i?this.hideFieldError():this.showFieldError()},e.prototype.showFieldError=function(){this.formLog[this.fieldName]||this.$field.prop("disabled")||(this.$field.removeClass(this.options.classSuccess),this.$field.addClass(this.options.classError),this.showFieldErrorMessage(this.$field.data("message")?this.$field.data("message"):a[this.fieldRuleName]))},e.prototype.hideFieldError=function(){this.$field.removeClass(this.options.classError),this.$field.addClass(this.options.classSuccess),this.hideFieldErrorMessage()},e.prototype.showFieldErrorMessage=function(i){var e,t,s;if("string"==typeof this.fieldRuleOpt&&(i=i.replace(/{\w+}/i,this.fieldRuleOpt)),this.fieldRuleOpt&&"object"==typeof this.fieldRuleOpt)for(t=0,s=this.fieldRuleOpt.length,t;s>t;t++)i=i.replace(/{\w+}/i,this.fieldRuleOpt[t]);return this.formLog[this.fieldName]=i,e=this.options.tpl.error.replace(/{message}/i,i),this.$field.after(e)},e.prototype.hideFieldErrorMessage=function(){return this.formLog[this.fieldName]=null,this.$field.next().remove()},e.prototype.parseErrors=function(i){return"string"==typeof i?JSON.parse(i):i},e.prototype.setErrors=function(i){var e,t;t=this.parseErrors(i);for(e in t)t.hasOwnProperty(e)&&(this.$field=this.$fields.filter("[name="+e+"]"),this.showFieldErrorMessage(t[e]))},i.fn[l]=function(t){return this.each(function(){var s,o;s=i(this),o=s.data(l),o||s.data(l,new e(this,t))})},i(function(){i("."+s.validFormClass).FormData()})}(jQuery,window,document);