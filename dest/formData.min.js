/**
 * formData - Form validation based on data attributes
 * @date - Sun May 29 2016 01:27:15 GMT+0200 (CEST)
 * @version - 1.0.1
 */
!function(t,i,e){"use strict";function r(i,e){this.$form=t(i),this.$form.attr("novalidate",!0),this.options=t.extend(!0,{},s,e),this.$fields=this.$form.find("[data-"+this.options.validDataAttr+"], [required]"),this.isFormValid=!1,this.formLog=[],this.version=l,this.getFieldsRules(),this.addFormEvents(),this.addFieldEvents()}var s,o,a,l,n;n={},a="FormData",l="1.0.1",o={validFormClass:"formdata"},s={keyup:!1,blur:!0,validDataAttr:"valid",classSuccess:"fd-success",classError:"fd-error",classFormError:"fd-form-invalid",placeForError:"afterInput",tpl:{error:'<span class="form-error">{message}</span>'},preventSubmit:!1,onError:null,onSuccess:null},r.prototype.getFieldsRules=function(){var i,e,r,s,o,a=null;i=this,this.fieldsRules=[],e=0,this.$fields.each(function(){r=t(this),s=r.data(i.options.validDataAttr)||null,r.data("field-id",e),r.attr("aria-invalid","false"),/\|/.test(s)?(s=s.split("|"),o=s[0],a=s[1],/\-/.test(a)&&(a=a.split("-"))):o=s,i.fieldsRules.push({name:o,opt:a}),e++})},r.prototype.addFieldEvents=function(){var t=this;this.$fields.on({keyup:function(i){9!==i.keyCode&&t.options.keyup&&t.validateField(this)},blur:function(){return t.options.blur?t.validateField(this):!1}})},r.prototype.addFormEvents=function(){var t=this;this.$form.on("submit",function(i){t.options.preventSubmit&&i.preventDefault(),t.validate()&&t.options.onSuccess(t.$form)})},r.prototype.validate=function(){var t=this;return this.$fields.each(function(){t.validateField(this)}),this.isFormValid=!this.parseFormLog(),this.isFormValid?this.$form.removeClass(this.options.classFormError):(this.$form.addClass(this.options.classFormError),"function"==typeof t.options.onError&&this.options.onError(this.formLog)),this.isFormValid},r.prototype.parseFormLog=function(){var t,i;for(i=0,t=0;t<this.formLog.length;t++)this.formLog[t]&&(i+=1);return i},r.prototype.validateField=function(i){this.$field=t(i),this.fieldId=this.$field.data("field-id"),this.fieldName=this.$field.attr("name"),this.value=t.trim(this.$field.val()),this.opt=this.fieldsRules[this.fieldId].opt,this.fieldRuleName=this.fieldsRules[this.fieldId].name?this.fieldsRules[this.fieldId].name:"required",this.validationRule=r.getRule(this.fieldRuleName),this.errorInScope=this.isInErrorScope(this.fieldName),this.isFieldValid(this.validationRule.fn.call(this))},r.prototype.isFieldValid=function(t){return t?this.hideFieldError():this.showFieldError()},r.prototype.isInErrorScope=function(t){var i,e;for(e=null,i=0;i<this.formLog.length;i++){this.formLog[i].fieldName==t,e={index:i};break}return e},r.prototype.showFieldError=function(){this.errorInScope||this.$field.prop("disabled")||(this.$field.removeClass(this.options.classSuccess),this.$field.addClass(this.options.classError),this.$field.attr("aria-invalid","true"),this.$field.data("message")?this.showFieldErrorMessage(this.$field.data("message")):this.showFieldErrorMessage(this.validationRule.message))},r.prototype.hideFieldError=function(){this.$field.removeClass(this.options.classError),this.$field.addClass(this.options.classSuccess),this.$field.attr("aria-invalid","false"),this.hideFieldErrorMessage()},r.prototype.showFieldErrorMessage=function(t){var i,e,r,s;if("string"==typeof this.opt&&(t=t.replace(/{\w+}/i,this.opt)),this.opt&&"object"==typeof this.opt)for(e=0,r=this.opt.length,e;r>e;e++)t=t.replace(/{\w+}/i,this.opt[e]);return this.formLog.push({fieldName:this.fieldName,message:t}),t="afterInput"==this.options.placeForError?t:this.formLog[0].message,i=this.options.tpl.error.replace(/{message}/i,t),"afterInput"==this.options.placeForError?this.$field.after(i):(s=this.$form.find(this.options.placeForError),s.length&&s.html(i)),i},r.prototype.hideFieldErrorMessage=function(){var t;return this.errorInScope&&this.formLog.splice(this.errorInScope.index,1),"afterInput"==this.options.placeForError?this.$field.next().remove():(t=this.$form.find(this.options.placeForError),t.length&&t.html("")),this},r.prototype.parseErrors=function(t){return"string"==typeof t?JSON.parse(t):t},r.prototype.setErrors=function(t){var i,e;e=this.parseErrors(t);for(i in e)e.hasOwnProperty(i)&&(this.$field=this.$fields.filter("[name="+i+"]"),this.showFieldErrorMessage(e[i]))},r.setup=function(i){s=t.extend(!0,{},s,i)},r.addRule=function(t,i,e){if(n[t])throw new Error("Validation rule:"+t+" already added.");if("function"!=typeof i)throw new Error("Rule function not defined.");n[t]={fn:i,message:e||"Error"}},r.getRule=function(t){if(!n[t])throw new Error("Validation rule:"+t+" doesn't exist.");return n[t]},window.FormData=r,t.fn[a]=function(i){return this.each(function(){var e,s;e=t(this),s=e.data(a),s||e.data(a,new r(this,i))})},t(function(){t("."+o.validFormClass).FormData()})}(jQuery,window,document),function(t){FormData.addRule("required",function(){return this.value.length},"This field is required."),FormData.addRule("email",function(){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(this.value)},"Please enter a valid email address. For example user@site.com"),FormData.addRule("number",function(){var t=/^\d+$/;return t.test(this.value)},"Please enter numbers only."),FormData.addRule("float",function(){var t=/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/;return t.test(this.value)},"Please enter numbers with float point."),FormData.addRule("min",function(){return this.value.length>=Math.floor(this.opt)},"You should fill minimum {min} characters."),FormData.addRule("max",function(){return this.value.length<=Math.floor(this.opt)&&this.value.length},"You should fill maximum {max} characters"),FormData.addRule("range",function(){return this.value.length>=Math.floor(this.opt[0])&&this.value.length<=Math.floor(this.opt[1])},"You should fill from {min} to {max} characters.")}(jQuery);